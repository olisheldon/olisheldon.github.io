---
title: "Day 22: Monkey Market"
description: Pseudorandom Number Games <br/> Difficulty ★★
layout: nested
---

# Day 22: Monkey Market

[**link**](https://adventofcode.com/2024/day/22)

[**input**](https://github.com/olisheldon/aoc24/blob/main/data/day22.txt)

[**my solution**](https://github.com/olisheldon/aoc24/blob/main/python/day22.py)

## Description

This problem involves analyzing sequences of pseudorandom numbers generated by different "buyers" in a monkey market. Each buyer generates numbers using a specific algorithm that involves mixing (XOR operations) and pruning (modulo operations) steps.

The challenge is to predict these sequences accurately and then analyze patterns in the least significant digits to maximize a reward (bananas) when trading with the buyers.

## Part 1

### Number Generation

The first part requires implementing the number generation algorithm exactly as specified. Each new number in the sequence is generated through three steps:

1. Multiply by 64, mix (XOR), and prune (modulo 16777216)
2. Divide by 32, mix (XOR), and prune
3. Multiply by 2048, mix (XOR), and prune

I implemented these operations in separate functions for clarity:
- `mix()`: Performs the XOR operation
- `prune()`: Performs the modulo operation
- `evolve()`: Combines all steps to generate the next number

The solution involves generating 2000 numbers for each buyer and summing the final (2000th) number from each sequence.

## Part 2

### Price Analysis

Part 2 is more complex and involves looking at patterns in the least significant digits (prices) of the generated numbers. The key aspects are:

1. Extract the ones digit from each number to get the price
2. Calculate consecutive differences between prices
3. Find sequences of four consecutive price changes
4. Identify the sequence that maximizes total earnings when applied across all buyers

### Algorithm

I approached this by:

1. Generating the full sequence of 2000 numbers for each buyer
2. Converting each number to its price (ones digit)
3. Computing all possible 4-length sequences of price changes
4. Using Counter to find which sequence appears most profitably across all buyers

The solution is quite elegant in its use of Python's Counter class to find the most profitable sequence of price changes.

## Improvements

### Part 1

The number generation is straightforward and efficient. However, we could potentially:
- Add type hints for better code documentation
- Create a class to encapsulate the number generation logic
- Add validation for input values

### Part 2

The current solution works well but could be improved by:
- Optimizing memory usage by not storing all 2000 numbers at once
- Using more descriptive variable names
- Adding comments to clarify the logic of finding optimal price change sequences

### Software Engineering

Some general improvements could include:
- Adding unit tests for the number generation functions
- Better error handling for invalid inputs
- Using dataclasses to represent buyers and their sequences
- Adding logging for debugging

## Solutions

### Python Solution

<div class="aside">
<iframe frameborder="0" scrolling="yes" style="width:100%; height:1972px;" allow="clipboard-write" src="https://emgithub.com/iframe.html?target=https%3A%2F%2Fgithub.com%2Folisheldon%2Faoc24%2Fblob%2Fmain%2Fpython%2Fday22.py&style=github-dark&type=code&showBorder=on&showLineNumbers=on&showCopy=on&fetchFromJsDelivr=on"></iframe>
</div>

### Agentic C++ translation of Python Solution

<div class="aside">
<iframe frameborder="0" scrolling="yes" style="width:100%; height:1972px;" allow="clipboard-write" src="https://emgithub.com/iframe.html?target=https%3A%2F%2Fgithub.com%2Folisheldon%2Faoc24%2Fblob%2Fmain%2Fagentic_ai_translations%2Fcpp%2Fday22.cpp&style=github-dark&type=code&showBorder=on&showLineNumbers=on&showCopy=on&fetchFromJsDelivr=on"></iframe>
</div>